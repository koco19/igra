library(dplyr)
library(ggplot2)
library(tidyr)
library(ggthemes)
library(colorspace)
library(readxl)
library(forcats)
library(scales)
library(gridExtra)
library(cowplot)
library(Cairo)
library(stringr)
library(ggpubr)
library(rstatix)
library(EnvStats)
library(lme4)
library(effects)
library(broom)
library(broom.mixed)
library(extrafont)
loadfonts(quiet = TRUE)
library(ggthemes)
# Define theme and colors
theme_set(theme_classic())
theme_update(strip.background = element_rect(colour = "white", fill = "white"))
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
here_r = function (...) here::here("Statistics", ...)
here_data_tcell = function (...) here::here("Data-t-cell", ...)
here_output = function (...) here::here("Output", ...)
######################################################## Load data
load(here_data_tcell("data-raw-tcell-210315.RData"))
head(data)
# Minor modifications to the data
data <- data %>%
rename(NC = "Capsid sub x5",
M = "Membrane sub x5",
SNT = "SNT sub x5",
SCT = "SCT sub x5",
`Pepmix (green)` = "gr端n sbu x5",
`Pepmix (yellow)` = "yellow sub x5")
data.long <- data.long %>%
mutate(Antigen = case_when(
Antigen == "Capsid sub x5" ~ "NC",
Antigen == "Membrane sub x5" ~ "M",
Antigen == "SNT sub x5" ~ "SNT",
Antigen == "SCT sub x5" ~ "SCT",
Antigen == "gr端n sbu x5" ~ "Pepmix (green)",
Antigen == "yellow sub x5" ~ "Pepmix (yellow)"))
data.long <- data.long %>%
mutate(IgG = as.numeric(IgG))
data <- data %>%
mutate(IgG = as.numeric(IgG))
head(data)
library(dplyr)
library(ggplot2)
library(tidyr)
library(ggthemes)
library(colorspace)
library(readxl)
library(forcats)
library(scales)
library(gridExtra)
library(cowplot)
library(Cairo)
library(stringr)
library(ggpubr)
library(rstatix)
library(EnvStats)
library(lme4)
library(effects)
library(broom)
library(broom.mixed)
library(extrafont)
loadfonts(quiet = TRUE)
library(ggthemes)
# Define theme and colors
theme_set(theme_classic())
theme_update(strip.background = element_rect(colour = "white", fill = "white"))
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
here_r = function (...) here::here("Statistics", ...)
here_data_tcell = function (...) here::here("Data-t-cell", ...)
here_output = function (...) here::here("Output", ...)
######################################################## Load data
load(here_data_tcell("data-raw-tcell-210315.RData"))
head(data)
library(dplyr)
library(ggplot2)
library(tidyr)
library(ggthemes)
library(colorspace)
library(readxl)
library(forcats)
library(scales)
library(gridExtra)
library(cowplot)
library(Cairo)
library(stringr)
library(ggpubr)
library(rstatix)
library(EnvStats)
library(lme4)
library(effects)
library(broom)
library(broom.mixed)
library(extrafont)
loadfonts(quiet = TRUE)
library(ggthemes)
# Define theme and colors
theme_set(theme_classic())
theme_update(strip.background = element_rect(colour = "white", fill = "white"))
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
here_r = function (...) here::here("Statistics", ...)
here_data_tcell = function (...) here::here("Data-t-cell", ...)
here_output = function (...) here::here("Output", ...)
######################################################## Load data
load(here_data_tcell("data-raw-tcell-210315.RData"))
head(data)
# Minor modifications to the data
data <- data %>%
rename(NC = "Capsid sub x5",
M = "Membrane sub x5",
SNT = "SNT sub x5",
SCT = "SCT sub x5",
`Pepmix (green)` = "gr端n sbu x5",
`Pepmix (yellow)` = "yellow sub x5")
data.long <- data.long %>%
mutate(Antigen = case_when(
Antigen == "Capsid sub x5" ~ "NC",
Antigen == "Membrane sub x5" ~ "M",
Antigen == "SNT sub x5" ~ "SNT",
Antigen == "SCT sub x5" ~ "SCT",
Antigen == "gr端n sbu x5" ~ "Pepmix (green)",
Antigen == "yellow sub x5" ~ "Pepmix (yellow)"))
data.long <- data.long %>%
mutate(IgG = as.numeric(IgG))
data <- data %>%
mutate(IgG = as.numeric(IgG))
#---------------------------------------------------- Figure 2a
s <- data.long %>%
filter(Group.5 %in% c("Controls", "PCR+ Seropositive")) %>%
filter(Antigen %in% c("NC", "M", "SNT", "SCT")) %>%
mutate(value = ifelse(value == 0, 0.01, value)) %>%
mutate(Group.5 = case_when(
Group.5 == "Controls" ~ "Controls",
Group.5 == "PCR+ Seropositive" ~ "PCR+\nSeropositive")) %>%
filter(!is.na(value))
s
ss <- s %>%
group_by(Antigen, Group.5) %>%
count() %>%
rename(n.ind = n)
ss
sss <- s %>%
mutate(zero = ifelse(value == 0.01, TRUE, FALSE)) %>%
group_by(Antigen, Group.5, zero) %>%
count()
sss
fig2a <- s %>%
select(LabId, Group.5, Antigen, value) %>%
ggplot(aes(x=Group.5, y=value, color=Group.5)) +
geom_jitter(alpha=0.4, width=0.2) +
facet_wrap(~fct_inorder(Antigen), ncol=4) +
scale_y_continuous(trans="log2", breaks=c(0.01, 5, 40, 250, 2500),
labels=c(0, 5, 40, 250, 2500)) +
xlab("") + ylab(expression(paste("IFN", gamma, " (mIU/ml)"))) +
theme(legend.position = "none") +
scale_color_manual(values=cbPalette[c(2,4)]) +
geom_hline(yintercept=40, color="grey", lty=2) +
stat_summary(geom = "point", fun = "median", col = "black",
size = 7, shape=95) +
geom_text(data=sss %>% filter(zero), aes(y=0.05,
label=paste0("n=", n)), size=3) +
geom_text(data=sss %>% filter(!zero), aes(y=20000,
label=paste0("n=", n)), size=3) +
stat_n_text(size=3, y.pos=-8)
fig2a
#---------------------------------------------------- Figure 2b
n.ind <- data.long %>%
filter(!is.na(Group.5)) %>%
filter(Group.5 %in% c("Exposed Seropositive", "PCR+ Seropositive",
"PCR+ Seronegative")) %>%
filter(Antigen %in% c("NC", "M", "SCT", "SNT")) %>%
filter(!is.na(value)) %>%
group_by(Antigen) %>%
count() %>%
rename(n.ind = n)
n.ind
s <- data.long %>%
filter(Group.5 %in% c("PCR+ Seropositive", "PCR+ Seronegative",
"Exposed Seropositive")) %>%
filter(Antigen %in% c("NC", "M", "SNT", "SCT")) %>%
mutate(value = ifelse(value == 0, 0.01, value)) %>%
mutate(Group.5 = case_when(
Group.5 == "PCR+ Seropositive" ~ "PCR+\nSeropositive",
Group.5 == "PCR+ Seronegative" ~ "PCR+\nSeronegative",
Group.5 == "Exposed Seropositive" ~ "Exposed\nSeropositive")) %>%
filter(!is.na(value))
s
ss <- s %>%
group_by(Antigen, Group.5) %>%
count()
ss
sss <- s %>%
mutate(zero = ifelse(value == 0.01, TRUE, FALSE)) %>%
group_by(Antigen, zero) %>%
count() %>%
left_join(n.ind) %>%
mutate(Antigen = paste0(Antigen, "\n(n=", n.ind, ")"))
sss
mann.whitney <- list(c(sss$Antigen[1], sss$Antigen[3]),
c(sss$Antigen[1], sss$Antigen[5]),
c(sss$Antigen[1], sss$Antigen[7]),
c(sss$Antigen[3], sss$Antigen[5]),
c(sss$Antigen[3], sss$Antigen[7]),
c(sss$Antigen[5], sss$Antigen[7]))
data_tests <- data.long %>%
filter(!is.na(Group.5)) %>%
filter(Group.5 %in% c("Exposed Seropositive",
"PCR+ Seropositive","PCR+ Seronegative")) %>%
filter(Antigen %in% c("NC", "M", "SCT", "SNT")) %>%
left_join(n.ind) %>%
mutate(Antigen.new = paste0(Antigen, "\n(n=", n.ind, ")")) %>%
mutate(value = ifelse(value == 0, 0.1, value)) %>%
select(LabId, Group.5, Antigen, Antigen.new, value, n.ind) %>%
# mutate(value = log10(value))
mutate(value = log2(value))
wilcox_test <- wilcox_test(formula = value~Antigen.new,
data = data_tests,
comparisons = mann.whitney,
p.adjust.method = "bonferroni",
paired=TRUE)
fig2b <- s %>%
left_join(n.ind) %>%
mutate(Antigen = paste0(Antigen, "\n(n=", n.ind, ")")) %>%
ggplot(aes(x=fct_inorder(Antigen), y=value)) +
geom_jitter(aes(color=Group.5), alpha=0.4, width=0.2) +
#scale_y_log10() +
scale_y_continuous(trans="log2", breaks=c(0.01, 5, 40, 250, 2500),
labels=c(0, 5, 40, 250, 2500)) +
xlab("") + ylab(expression(paste("IFN", gamma, " (mIU/ml)"))) +
scale_color_manual(values=cbPalette[c(6,8,4)], name="Group",
breaks=c("Exposed\nSeropositive", "PCR+\nSeronegative",
"PCR+\nSeropositive"),
labels=c("Exposed Seropositive", "PCR+ Seronegative",
"PCR+ Seropositive")) +
geom_hline(yintercept=40, color="grey", lty=2) +
stat_summary(geom = "point", fun = "median", col = "black",
size = 7, shape=95) +
#  stat_compare_means(comparisons = mann.whitney, method = "wilcox.test",
#                   size=3)
stat_pvalue_manual(wilcox_test[c(1,4,3),], label = "p.adj.signif", paired=TRUE,
y.position = 13, step.increase = 0.06, size=3)
fig2b
# Additional information for Figure 2b
# Exact p-values
fig2bpv <- s %>%
left_join(n.ind) %>%
mutate(Antigen = paste0(Antigen, "\n(n=", n.ind, ")")) %>%
ggplot(aes(x=Antigen, y=value)) +
geom_jitter(aes(color=Group.5), alpha=0.4, width=0.2) +
#scale_y_log10() +
scale_y_continuous(trans="log2", breaks=c(0.01, 5, 40, 250, 2500),
labels=c(0, 5, 40, 250, 2500)) +
xlab("") + ylab(expression(paste("IFN", gamma, " (pg/ml)"))) +
scale_color_manual(values=cbPalette[c(6,8,4)], name="Group",
breaks=c("Exposed\nSeropositive", "PCR+\nSeronegative",
"PCR+\nSeropositive"),
labels=c("Exposed Seropositive", "PCR+ Seronegative",
"PCR+ Seropositive")) +
geom_hline(yintercept=40, color="grey", lty=2) +
stat_summary(geom = "point", fun = "median", col = "black",
size = 7, shape=95) +
stat_pvalue_manual(wilcox_test, label = "p.adj", paired=TRUE,
y.position = 15, step.increase = 0.1, size=3)
fig2bpv
# Calculate medians of this plot
s %>%
group_by(Antigen) %>%
summarize(median = median(value))
s <- data.long %>%
#filter(Group.5 %in% c("Controls", "PCR+ Seropositive")) %>%
filter(Antigen %in% c("NC", "M", "SNT", "SCT")) %>%
mutate(value = ifelse(value == 0, 0.01, value)) %>%
mutate(Group.5 = case_when(
Group.5 == "Controls" ~ "Controls",
Group.5 == "Exposed Seronegative" ~ "Exposed\nSeronegative",
Group.5 == "Exposed Seropositive" ~ "Exposed\nSeropositive",
Group.5 == "PCR+ Seronegative" ~ "PCR+\nSeronegative",
Group.5 == "PCR+ Seropositive" ~ "PCR+\nSeropositive")) %>%
filter(!is.na(value))
s
ss <- s %>%
group_by(Antigen, Group.5) %>%
count() %>%
rename(n.ind = n)
ss
sss <- s %>%
mutate(zero = ifelse(value == 0.01, TRUE, FALSE)) %>%
group_by(Antigen, Group.5, zero) %>%
count()
sss
fig2c <- s %>%
select(LabId, Group.5, Antigen, value) %>%
filter(!is.na(Group.5)) %>%
ggplot(aes(x=Group.5, y=value, color=Group.5)) +
geom_jitter(alpha=0.4, width=0.2) +
facet_wrap(~fct_inorder(Antigen), ncol=4) +
scale_y_continuous(trans="log2", breaks=c(0.01, 5, 40, 250, 2500),
labels=c(0, 5, 40, 250, 2500)) +
xlab("") + ylab(expression(paste("IFN", gamma, " (mIU/ml)"))) +
theme(legend.position = "none") +
scale_color_manual(values=cbPalette[c(2,3, 6, 8, 4)]) +
geom_hline(yintercept=40, color="grey", lty=2) +
stat_summary(geom = "point", fun = "median", col = "black",
size = 7, shape=95) +
geom_text(data=sss %>% filter(zero), aes(y=0.05,
label=paste0("n=", n)), size=3) +
geom_text(data=sss %>% filter(!zero), aes(y=20000,
label=paste0("n=", n)), size=3) +
stat_n_text(size=3, y.pos=-8) +
theme(axis.text.x = element_text(angle = 90))
fig2c
plot_grid(fig2a, fig2b, labels=c("A", "B"),
rel_widths=c(0.5, 0.5))
ggsave(here_output("Figure_2.pdf"), height=8, width=12)
ggsave(here_output("Figure_2.png"), height=8, width=12)
ggsave(here_output("Figure_2.pdf"), height=5, width=12)
ggsave(here_output("Figure_2.png"), height=5, width=12)
ggsave(here_output("Figure_S2.pdf"), height=5, width=12)
plot_grid(fig2a, fig2b, labels=c("A", "B"),
rel_widths=c(0.5, 0.5))
ggsave(here_output("Figure_2.pdf"), height=5, width=12)
ggsave(here_output("Figure_2.png"), height=5, width=12)
fig2c
ggsave(here_output("Figure_S2.pdf"), height=5, width=12)
ggsave(here_output("Figure_S2.png"), height=5, width=12)
plot_grid(fig2a, fig2b, labels=c("A", "B"),
rel_widths=c(0.5, 0.5))
ggsave(here_output("Figure_2.pdf"), height=4, width=10)
ggsave(here_output("Figure_2.png"), height=4, width=10)
fig2c
ggsave(here_output("Figure_S2.pdf"), height=4, width=10)
ggsave(here_output("Figure_S2.png"), height=4, width=10)
ggsave(here_output("Figure_S2.pdf"), height=5, width=10)
ggsave(here_output("Figure_S2.png"), height=5, width=10)
plot_grid(fig2a, fig2b, labels=c("A", "B"),
rel_widths=c(0.5, 0.5))
ggsave(here_output("Figure_2.pdf"), height=5, width=10)
ggsave(here_output("Figure_2.png"), height=5, width=10)
